#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

download() {
  declare -r download_type="$1"
  declare -r download_version="$2"
  declare -r download_path="$3"

  rm -rf "$download_path"
  git init "$download_path"
  cd "$download_path"
  cat << EOF > tools.go
// +build tools

package tools

import (
	_ "sigs.k8s.io/controller-tools/cmd/controller-gen"
	_ "sigs.k8s.io/controller-tools/cmd/helpgen"
	_ "sigs.k8s.io/controller-tools/cmd/type-scaffold"
)
EOF
cat << EOF > go.mod
module github.com/jimmidyson/asdf-kube-controller-tools

go 1.16

require sigs.k8s.io/controller-tools v${download_version}
EOF
  go mod tidy
}

download "$ASDF_INSTALL_TYPE" "$ASDF_INSTALL_VERSION" "$ASDF_DOWNLOAD_PATH"
